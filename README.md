# Obsidian Google Calendar Tasks Sync Plugin

## 日本語

### 1. プラグインのインストール

1. このリポジトリをクローンまたはダウンロードします
2. `.obsidian/plugins/obsidian-google-calendar-tasks-sync-plugin` フォルダに内容をコピーします
3. **設定 > コミュニティプラグイン** でプラグインを有効化します

### 2. Google認証

1. プラグイン設定で **「Googleで認証」** をクリック
2. Googleアカウントでサインインし、カレンダーへのアクセスを許可
3. 同期先のカレンダーを選択

### 3. Obsidianでタスクを書く

Tasksプラグインの構文を使用します。例:

```
- [ ] タスク内容 📅 2025-04-17 ⏰ 14:00
```

期日/開始日があるタスクがGoogleカレンダーに同期されます

### ⚙️ 設定項目の詳細

#### 認証設定
- **Client ID/Secret**: Google Cloud Consoleで取得したOAuth認証情報
- **Redirect URI**: `obsidian://oauth2callback` (デフォルト)

#### 同期設定
- **Target Calendar ID**: 同期先カレンダーID (`primary` がデフォルト)
- **Auto Sync**: 自動同期を有効/無効
- **Sync Interval**: 自動同期間隔(分) デフォルト15分

#### タスク同期動作
- **Use Start Date (🛫)**: 開始日をイベント開始日として使用
- **Use Scheduled Date (⏳)**: 予定日をイベント開始日として使用
- **Default Event Duration**: 時間指定なしタスクのデフォルト期間(分)

#### 説明文追加設定
- **Add Priority to Description**: 優先度を説明に追加
- **Add Tags to Description**: タグを説明に追加
- **Add Block Link to Description**: ブロックリンクを説明に追加

### ⚠️ 注意事項
- 初回同期には数分かかる場合があります
- モバイル版Obsidianでは認証フローが異なる場合があります
- 大量のタスクを一度に同期するとAPI制限に達する可能性があります

### 🔧 既知の問題
- **存在しないイベントの削除試行**: 
  - 同期処理中に既に削除済みのイベントに対して削除リクエストを送信する場合があります
  - この場合、Google Calendar APIから404エラーが返されますが、タスクマップは自動修復され処理は継続されます
  - 最新バージョンでは指数バックオフ再試行メカニズムが実装されています

- **APIレート制限**:
  - 大量の変更を同期する場合、Google Calendar APIのレート制限に達する可能性があります
  - 最新バージョンでは動的なリクエスト間隔調整と最大3回の自動再試行機能を実装

### 🛠 トラブルシューティング
#### Google Calendar API エラーコード
- **404 (Not Found)**:
  - 原因: 存在しないイベントIDに対して操作を試みた
  - 対処: プラグイン設定で「マッピングをリセット」を実行後、再同期
  
- **403 (Rate Limit Exceeded)**:
  - 原因: APIのレート制限に達した
  - 対処: 同期間隔を長く設定（推奨: 30分以上）

#### 同期エラー時の対処手順
1. プラグイン設定を開く
2. 「デバッグログを有効化」をONにする
3. 手動同期を実行
4. コンソールログを確認
5. エラー内容に応じて以下の対処法を実施:
   - 404エラー: 自動修復されるため待機
   - 403/429エラー: 同期間隔を30分以上に設定
   - 5xxエラー: 数分待ってから再試行
6. 問題が解決しない場合、設定から「マッピングをリセット」を実行

---

## タスク別の結果（期待動作）

以下は代表的な入力例と、Google カレンダー上での最終的な時間解釈の一覧である。

- [ ] タスク 🛫 2025-08-31 15:00 📅 2025-09-01 23:00
  - 2025-08-31 15:00 → 2025-09-01 23:00（そのまま時刻付き）

- [ ] タスク3 🛫 2025-08-31 15:00 📅 2025-08-31
  - 2025-08-31 15:00 → 2025-09-01 00:00（＝同日24:00）に変換

- [ ] タスク4 🛫 2025-08-31 📅 2025-08-31 🔁 15:00~24:00
  - 2025-08-31 15:00 → 2025-09-01 00:00（時間ウィンドウ適用）

- [ ] タスク5 🛫 2025-08-31 📅 2025-09-02 🔁 every day 15:00~24:00
  - 2025-08-31 15:00 → 24:00 のイベントを起点に、RRULE:FREQ=DAILY;COUNT=3 を自動生成（31, 1, 2 の3回）

- [ ] タスク2 🛫 2025-08-31 📅 2025-08-31
  - 時刻指定なし → 終日イベント（既定どおり、終了は翌日をexclusive）

## 🧾 ライセンス

[MIT](LICENSE)
本プラグインは MIT ライセンスのもとで自由に使用できます。  
ただし、以下のような**公開の場で紹介・使用される場合**は、  
可能であれば次のいずれかへのリンクを表示していただけると嬉しいです：

- GitHub: [https://github.com/Mekann2904/obsidian-google-calendar-tasks-sync-plugin](https://github.com/Mekann2904/obsidian-google-calendar-tasks-sync-plugin)
- X (旧Twitter): [https://x.com/Mekann2904](https://x.com/Mekann2904)

---
# 謝辞
- Obsidian Tasksプラグインの開発者の方々に感謝します。   
  [https://github.com/obsidian-tasks-group/obsidian-tasks](https://github.com/obsidian-tasks-group/obsidian-tasks)

---
